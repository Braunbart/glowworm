<!DOCTYPE html>
<html>

<head>
	<meta charset="utf8">
	<title>three.js app</title>
	<style>
		body {
			margin: 0;
			position: relative;
		}

		#twodee {
			position: absolute;
			z-index: 10;
			width: 300px;
			height: 180px;
			background: #ffffff;
		}
	</style>
</head>

<body>
	<div id="twodee">
		<div>
			Frequency
			<input id="frequency" type="range" value="0.0075" min="0.001" max="0.01" step="0.0005" />
		</div>
	</div>
	<script src="js/three.min.js"></script>
	<script src="js/OrbitControls.js"></script>
	<script src="js/TranformControls.js"></script>
	<script src="js/mainloop.js"></script>
	<script>
		var step = 0;

		var SCENE, CAMERA, RENDERER, CUBES, EFFECT;

		var init = function () {
			CUBES = [];
			SCENE = new THREE.Scene();
			CAMERA = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
			CAMERA.position.z = 10;

			RENDERER = new THREE.WebGLRenderer();
			RENDERER.setSize(window.innerWidth, window.innerHeight);
			document.body.appendChild(RENDERER.domElement);

			for (let i = -3; i < 5; i++) {
				var geometry = new THREE.IcosahedronGeometry(0.5, 1);
				var material = new THREE.MeshBasicMaterial({ color: 0xffffff });
				var cube = new THREE.Mesh(geometry, material);
				cube.position.x = Math.abs(i) * 2 - 3;
				cube.position.y = Math.sin(i) * 2;
				if (i == 3) {
					cube.position.x = 0;
					cube.position.y = 0;
					cube.position.z = -2;
				}
				if (i == 4) {
					cube.position.x = 0;
					cube.position.y = 0;
					cube.position.z = 2;
				}
				SCENE.add(cube);
				CUBES.push(cube);
			}



			var effectGeometry = new THREE.SphereGeometry(5);
			var effectMaterial = new THREE.MeshBasicMaterial({ wireframe: true, color: '#ff9999', transparent: true, opacity: 0.2 });
			EFFECT = new THREE.Mesh(effectGeometry, effectMaterial);
			SCENE.add(EFFECT);



			var orbit = new THREE.OrbitControls(CAMERA, RENDERER.domElement);
			orbit.update();

			var control = new THREE.TransformControls(CAMERA, RENDERER.domElement);
			control.addEventListener('dragging-changed', function (event) {
				orbit.enabled = !event.value;
			});
			control.attach(EFFECT);
			SCENE.add(control);

			window.addEventListener('keydown', function (event) {
				switch (event.keyCode) {
					case 17: // Ctrl
						control.setTranslationSnap(100);
						control.setRotationSnap(THREE.Math.degToRad(15));
						break;
					case 87: // W
						control.setMode("translate");
						break;
					case 69: // E
						control.setMode("rotate");
						break;
					case 82: // R
						control.setMode("scale");
						break;
					case 32: // Spacebar
						control.enabled = !control.enabled;
						break;
				}
			});
		}

		function sineColor(step) {
			return Math.round(Math.abs(Math.sin(step)) * 255);
		}

		function sineWaveColor(step, distance) {
			return Math.round(Math.abs(Math.sin(step + (distance))) * 255);

		}

		var update = function () {
			for (let i = 0; i < CUBES.length; i++) {
				let distance = EFFECT.position.distanceTo(CUBES[i].position);
				let radius = EFFECT.geometry.parameters.radius * EFFECT.scale.x;
				let normalized = 1 - distance / radius;

				//let color = Math.max(0, 255-Math.round(normalized*255)); // distance
				//let color = Math.max(0, Math.round(sineColor(step) * normalized)); // pulse
				let color = Math.max(0, Math.round(sineWaveColor(step, normalized) * normalized)); // wave

				CUBES[i].material.color = new THREE.Color(`rgb(${color}, ${color}, ${color})`);
				step += parseFloat(frequency.value);//0.0075;
			}
		};

		var animate = function () {
			RENDERER.render(SCENE, CAMERA);
		}

		init();
		MainLoop.setUpdate(update).setDraw(animate).start();
	</script>
</body>

</html